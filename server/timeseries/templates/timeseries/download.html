{% extends "timeseries/seriespicker.html" %}

{% block title %}Download Data{% endblock title %}

{% block ui %}
<button class="btn btn-tm" id="downloadBtn">Download CSV</button>
<script>
// thanks to http://stackoverflow.com/questions/3749231/download-file-using-javascript-jquery
var downloadURL = function downloadURL(url) {
	var hiddenIFrameID = 'hiddenDownloader',
		iframe = document.getElementById(hiddenIFrameID);
	if (iframe === null) {
		iframe = document.createElement('iframe');
		iframe.id = hiddenIFrameID;
		iframe.style.display = 'none';
		document.body.appendChild(iframe);
	}
	iframe.src = url;
};

$(document).ready(function(){
	// callback
	function download_csv(series_obj){
		if(daterange.startDate == null || daterange.endDate == null){
			console.log('BAD FORM: cannot deal with null datetime');
			return;
		}
		series_obj['tstart'] = daterange.startDate.toISOString();
		series_obj['tend'] = daterange.endDate.toISOString();
		var url = '/data/api/csv/?' + $.params(series_obj);
		downloadURL(url);
	}
	$("#downloadBtn").click(function(){
		download_csv(make_series_obj());
	});
});
</script>
{% endblock ui %}